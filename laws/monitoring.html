<!DOCTYPE html><html><head><title>Talos: Monitoring</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Vasilis Nicolaou" /><meta name="description" content="Lawful circuit breakers in Scala" /><meta name="og:image" content="/img/poster.png" /><meta name="image" property="og:image" content="/img/poster.png" /><meta name="og:title" content="Talos: Monitoring" /><meta name="title" property="og:title" content="Talos: Monitoring" /><meta name="og:site_name" content="Talos" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Lawful circuit breakers in Scala" /><link rel="icon" type="image/png" href="/img/favicon.png" /><meta name="twitter:title" content="Talos: Monitoring" /><meta name="twitter:image" content="https://sbt-kubeyml.vaslabs.org/img/poster.png" /><meta name="twitter:description" content="Lawful circuit breakers in Scala" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:creator" content="@vaslabs" /><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/highlight/styles/vs.css" /><link rel="stylesheet" href="/css/pattern-style.css" /><link rel="stylesheet" href="/css/home.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/" class="brand"><div class="brand-wrapper"><span>Talos</span></div></a></li> <li><a href="/events/events.html" class="">Events</a></li> <li><a href="/kamon/kamon.html" class="">Kamon</a></li> <li><a href="/gateway/" class="">API Gateway</a></li> <li><a href="/advanced/" class="">Advanced</a> <ul class="sub-section"> <li><a href="/monix/monix.html" class="">Monix circuit breakers</a></li> <li><a href="/talostypeclass/generic.html" class="">Generic solution</a></li></ul></li> <li><a href="/laws/" class="">Talos Laws</a> <ul class="sub-section"> <li><a href="/laws/timeouts.html" class="">Timeout laws</a></li> <li><a href="/laws/monitoring.html" class="">Monitoring laws</a></li> <li><a href="/laws/fallbacks.html" class="">Fallback laws</a></li></ul></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/vaslabs/talos" target="_blank" rel="noopener noreferrer"><i class="fa fa-eye"></i><span>Watchers<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/vaslabs/talos" target="_blank" rel="noopener noreferrer"><i class="fa fa-star-o"></i><span>Stars<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('Talos Lawful circuit breakers in Scala');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('Talos Lawful circuit breakers in Scala');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="vaslabs" data-github-repo="talos"><div class="content-wrapper"><section><h2 id="the-monitoring-law">The monitoring law</h2>

<p>Talos is enforcing the Circuit Breaker implementation to expose their state changes as events.
Although both provided Monix and Akka implementations expose those events in the Akka EventStream, it is up to
the user how their implementations will expose such events.</p>

<p>The law check requires the user to provide the way such events can be read.</p>

<p>Every successful call generates a success event with the elapsed time that it took to complete such event.</p>

<p>Subscription to such events can be done via the provided event bus.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">akka.actor.typed.</span><span class="o">{</span><span class="nc">ActorSystem</span><span class="o">,</span> <span class="nc">ActorRef</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">akka.actor.typed.Behavior</span>
<span class="k">import</span> <span class="nn">akka.actor.typed.scaladsl.ActorContext</span>
<span class="k">import</span> <span class="nn">akka.actor.typed.scaladsl.Behaviors</span>
<span class="k">import</span> <span class="nn">akka.actor.typed.scaladsl.adapter._</span>
<span class="k">import</span> <span class="nn">akka.util.Timeout</span>

<span class="k">import</span> <span class="nn">cats.effect._</span>

<span class="k">import</span> <span class="nn">scala.concurrent.duration._</span>
<span class="k">import</span> <span class="nn">talos.circuitbreakers.akka._</span>
<span class="k">import</span> <span class="nn">talos.events.TalosEvents.model._</span>

<span class="k">import</span> <span class="nn">scala.concurrent.ExecutionContext</span>
<span class="k">import</span> <span class="nn">scala.concurrent.Await</span>

<span class="k">val</span> <span class="nv">eventListenerBehavior</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">CircuitBreakerEvent</span><span class="o">]</span> <span class="k">=</span> <span class="nv">Behaviors</span><span class="o">.</span><span class="py">receiveMessage</span> <span class="o">{</span>
  <span class="n">event</span> <span class="k">=&gt;</span>
    <span class="nf">println</span><span class="o">(</span><span class="n">event</span><span class="o">)</span>
    <span class="nv">Behaviors</span><span class="o">.</span><span class="py">same</span>
<span class="o">}</span>

<span class="k">def</span> <span class="nf">eventListener</span><span class="o">(</span><span class="n">actorContext</span><span class="k">:</span> <span class="kt">ActorContext</span><span class="o">[</span><span class="k">_</span><span class="o">])</span><span class="k">:</span> <span class="kt">ActorRef</span><span class="o">[</span><span class="kt">CircuitBreakerEvent</span><span class="o">]</span> <span class="k">=</span>
  <span class="nv">actorContext</span><span class="o">.</span><span class="py">spawn</span><span class="o">(</span><span class="n">eventListenerBehavior</span><span class="o">,</span> <span class="s">"eventListener"</span><span class="o">)</span>

<span class="k">def</span> <span class="nf">circuitBreaker</span><span class="o">(</span><span class="k">implicit</span> <span class="n">actorSystem</span><span class="k">:</span> <span class="kt">ActorSystem</span><span class="o">[</span><span class="k">_</span><span class="o">])</span> <span class="k">=</span> 
    <span class="nc">AkkaCircuitBreaker</span><span class="o">(</span><span class="s">"my_circuit_breaker"</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">2</span> <span class="n">seconds</span><span class="o">,</span> <span class="mi">5</span> <span class="n">seconds</span><span class="o">)</span>


<span class="k">def</span> <span class="nf">subscribe</span><span class="o">(</span><span class="n">eventListener</span><span class="k">:</span> <span class="kt">ActorRef</span><span class="o">[</span><span class="kt">CircuitBreakerEvent</span><span class="o">])(</span><span class="k">implicit</span> <span class="n">actorSystem</span><span class="k">:</span> <span class="kt">ActorSystem</span><span class="o">[</span><span class="k">_</span><span class="o">])</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">implicit</span> <span class="k">val</span> <span class="nv">akkaEventBus</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">AkkaEventBus</span><span class="o">()</span>
    
    <span class="nv">circuitBreaker</span><span class="o">.</span><span class="py">eventBus</span><span class="o">.</span><span class="py">subscribe</span><span class="o">(</span><span class="n">eventListener</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The events that expose the circuit breaker activity and state changes are the following:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">CircuitBreakerEvent</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">circuitBreakerName</span><span class="k">:</span> <span class="kt">String</span>
<span class="o">}</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">SuccessfulCall</span><span class="o">(</span><span class="n">circuitBreakerName</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">elapsedTime</span><span class="k">:</span> <span class="kt">FiniteDuration</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">CircuitBreakerEvent</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">CallFailure</span><span class="o">(</span><span class="n">circuitBreakerName</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">elapsedTime</span><span class="k">:</span> <span class="kt">FiniteDuration</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">CircuitBreakerEvent</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">CallTimeout</span><span class="o">(</span><span class="n">circuitBreakerName</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">elapsedTime</span><span class="k">:</span> <span class="kt">FiniteDuration</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">CircuitBreakerEvent</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">CircuitOpen</span><span class="o">(</span><span class="n">circuitBreakerName</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">CircuitBreakerEvent</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">CircuitHalfOpen</span><span class="o">(</span><span class="n">circuitBreakerName</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">CircuitBreakerEvent</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">CircuitClosed</span><span class="o">(</span><span class="n">circuitBreakerName</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">CircuitBreakerEvent</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">ShortCircuitedCall</span><span class="o">(</span><span class="n">circuitBreakerName</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">CircuitBreakerEvent</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">FallbackSuccess</span><span class="o">(</span><span class="n">circuitBreakerName</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">CircuitBreakerEvent</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">FallbackFailure</span><span class="o">(</span><span class="n">circuitBreakerName</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">CircuitBreakerEvent</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">FallbackRejected</span><span class="o">(</span><span class="n">circuitBreakerName</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">CircuitBreakerEvent</span>
</code></pre></div></div>

</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/highlight/highlight.pack.js"></script><script>
// For all code blocks, copy the language from the containing div
// to the inner code tag (where hljs expects it to be)
const langPrefix = 'language-';
document.querySelectorAll(`div[class^='${langPrefix}']`).forEach(function(div) {
  div.classList.forEach(function(cssClass) {
    if (cssClass.startsWith(langPrefix)) {
      const lang = cssClass.substring(langPrefix.length);
      div.querySelectorAll('pre code').forEach(function(code) {
        code.classList.add(lang);
      });
    }
  });
});

hljs.configure({languages:['scala','java','bash']});
hljs.initHighlightingOnLoad();
      </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script>((window.gitter = {}).chat = {}).options = {
room: 'vaslabs/talos'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/js/main.js"></script></body></html>